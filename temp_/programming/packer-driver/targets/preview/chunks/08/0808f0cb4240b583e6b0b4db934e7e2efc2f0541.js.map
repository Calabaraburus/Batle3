{"version":3,"sources":["file:///C:/Projects/Cocos/ClbBlast/assets/entities/tiles/UsualTile/StdTileController.ts"],"names":["_decorator","Sprite","Vec3","instantiate","Prefab","UITransform","TileController","TileState","ccclass","property","StdTileController","_curSprite","_state","_bombSprite","_rocketSprite","_starSprite","start","updateSprite","getComponent","spriteFrame","tileModel","sprite","state","setBomb","SpecialSprite","bomb","setRocket","rocket","setStar","star","resetSpecialSprite","empty","setModel","findAdditionalSprite","destroyTile","CreateParticles","ps","destroyPartycles","parent","node","ui","position","x","contentSize","width","y","height","z"],"mappings":"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","sourcesContent":["import {\r\n    _decorator,\r\n    Component,\r\n    Sprite,\r\n    SpriteFrame,\r\n    log,\r\n    EventTarget,\r\n    Button,\r\n    Vec3,\r\n    CCFloat,\r\n    ParticleSystem2D,\r\n    instantiate,\r\n    ParticleSystem,\r\n    Node,\r\n    Prefab,\r\n    UITransform\r\n} from 'cc';\r\nimport { TileController } from '../TileController';\r\nimport { TileModel } from '../../../models/TileModel';\r\nimport { TileState } from '../TileState';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('StdTileController')\r\nexport class StdTileController extends TileController {\r\n\r\n    private _curSprite: Sprite;\r\n    private _state: TileState;\r\n    private _bombSprite: SpriteFrame;\r\n    private _rocketSprite: SpriteFrame;\r\n    private _starSprite: SpriteFrame;\r\n\r\n    /** Special sprite */\r\n    @property(Sprite)\r\n    SpecialSprite: Sprite;\r\n\r\n    /** Destroy particle system */\r\n    @property(Prefab)\r\n    destroyPartycles: Prefab;\r\n\r\n\r\n    start() {\r\n        super.start();\r\n        this.updateSprite();\r\n    }\r\n\r\n    updateSprite() {\r\n        this._curSprite = this.getComponent(Sprite);\r\n        this._curSprite.spriteFrame = this.tileModel.sprite;\r\n    }\r\n\r\n    public get state(): TileState {\r\n        return this._state;\r\n    }\r\n\r\n    public setBomb() {\r\n        this.SpecialSprite.spriteFrame = this._bombSprite;\r\n        this._state = TileState.bomb;\r\n    }\r\n\r\n    public setRocket() {\r\n        this.SpecialSprite.spriteFrame = this._rocketSprite;\r\n        this._state = TileState.rocket;\r\n    }\r\n\r\n    public setStar() {\r\n        this.SpecialSprite.spriteFrame = this._starSprite;\r\n        this._state = TileState.star;\r\n    }\r\n\r\n    public resetSpecialSprite() {\r\n        this.SpecialSprite.spriteFrame = null;\r\n        this._state = TileState.empty;\r\n    }\r\n\r\n    public setModel(tileModel: TileModel) {\r\n        super.setModel(tileModel);\r\n        this._rocketSprite = tileModel.findAdditionalSprite(\"rocket\");\r\n        this._bombSprite = tileModel.findAdditionalSprite(\"bomb\");\r\n        this._starSprite = tileModel.findAdditionalSprite(\"star\");\r\n    }\r\n\r\n    public destroyTile() {\r\n        super.destroyTile();\r\n\r\n        this._curSprite = this.getComponent(Sprite);\r\n        this._curSprite.spriteFrame = null;\r\n        this.CreateParticles();\r\n        this.resetSpecialSprite();\r\n    }\r\n\r\n    private CreateParticles() {\r\n        const ps = instantiate(this.destroyPartycles)//.getComponent(ParticleSystem2D);\r\n        ps.parent = this.node.parent\r\n        const ui = this.getComponent(UITransform);\r\n        ps.position = new Vec3(this.node.position.x + ui.contentSize.width / 2,\r\n            this.node.position.y + ui.contentSize.height / 2,\r\n            this.node.position.z);\r\n    }\r\n}\r\n"]}