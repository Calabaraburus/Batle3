{"version":3,"sources":["file:///C:/Projects/Cocos/ClbBlast/assets/entities/tiles/BombTile/BombTileInterBehaviour.ts"],"names":["_decorator","TileInterBehaviour","BombTileController","ccclass","property","BombTileInterBehaviour","tileClicked","field","tile","bombTile","startRow","row","fireDistance","endRow","fieldModel","rows","startCol","col","endCol","cols","iterateTiles","callback","i","j","t","logicField","isDestroied","tileModel","tileName","activate","destroyTile"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAmBA,MAAAA,U,OAAAA,U;;AAGVC,MAAAA,kB,iBAAAA,kB;;AAEAC,MAAAA,kB,iBAAAA,kB;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBJ,U;AAE9B;AACA;AACA;;wCAGaK,sB,WADZF,OAAO,CAAC,wBAAD,C,gBAAR,MACaE,sBADb;AAAA;AAAA,oDAC+D;AAC3DC,QAAAA,WAAW,CAACC,KAAD,EAAyBC,IAAzB,EAA+C;AAEtD,cAAI,EAAEA,IAAI;AAAA;AAAA,uDAAN,CAAJ,EAA2C;AACvC;AACH;;AAED,gBAAMC,QAAQ,GAAGD,IAAjB;AAEA,cAAIE,QAAQ,GAAGF,IAAI,CAACG,GAAL,GAAWF,QAAQ,CAACG,YAAnC;AACAF,UAAAA,QAAQ,GAAGA,QAAQ,GAAG,CAAX,GAAe,CAAf,GAAmBA,QAA9B;AAEA,cAAIG,MAAM,GAAGL,IAAI,CAACG,GAAL,GAAWF,QAAQ,CAACG,YAAjC;AACAC,UAAAA,MAAM,GAAGA,MAAM,IAAIN,KAAK,CAACO,UAAN,CAAiBC,IAA3B,GACLR,KAAK,CAACO,UAAN,CAAiBC,IAAjB,GAAwB,CADnB,GACuBF,MADhC;AAGA,cAAIG,QAAQ,GAAGR,IAAI,CAACS,GAAL,GAAWR,QAAQ,CAACG,YAAnC;AACAI,UAAAA,QAAQ,GAAGA,QAAQ,GAAG,CAAX,GAAe,CAAf,GAAmBA,QAA9B;AAEA,cAAIE,MAAM,GAAGV,IAAI,CAACS,GAAL,GAAWR,QAAQ,CAACG,YAAjC;AACAM,UAAAA,MAAM,GAAGA,MAAM,IAAIX,KAAK,CAACO,UAAN,CAAiBK,IAA3B,GACLZ,KAAK,CAACO,UAAN,CAAiBK,IAAjB,GAAwB,CADnB,GACuBD,MADhC;;AAGA,gBAAME,YAAY,GAAIC,QAAD,IAA2C;AAE5D,iBAAK,IAAIC,CAAC,GAAGZ,QAAb,EAAuBY,CAAC,IAAIT,MAA5B,EAAoCS,CAAC,EAArC,EAAyC;AACrC,mBAAK,IAAIC,CAAC,GAAGP,QAAb,EAAuBO,CAAC,IAAIL,MAA5B,EAAoCK,CAAC,EAArC,EAAyC;AACrC,sBAAMC,CAAC,GAAGjB,KAAK,CAACkB,UAAN,CAAiBH,CAAjB,EAAoBC,CAApB,CAAV;AACAF,gBAAAA,QAAQ,CAACG,CAAD,CAAR;AACH;AACJ;AACJ,WARD;;AAUAJ,UAAAA,YAAY,CAAEI,CAAD,IAAuB;AAEhC,gBAAI,CAACA,CAAC,CAACE,WAAH,IACCF,CAAC,CAACG,SAAF,CAAYC,QAAZ,IAAwB,MADzB,KAECJ,CAAC,CAACG,SAAF,CAAYC,QAAZ,IAAwB,QAAxB,IACGJ,CAAC,CAACG,SAAF,CAAYC,QAAZ,IAAwB,MAH5B,CAAJ,EAGyC;AACrCJ,cAAAA,CAAC,CAACK,QAAF;AACH;AACJ,WARW,CAAZ;AAUAT,UAAAA,YAAY,CAAEI,CAAD,IAAuB;AAChC,gBAAI,CAACA,CAAC,CAACE,WAAH,IAAmBF,CAAC,CAACG,SAAF,CAAYC,QAAZ,IAAwB,MAA/C,EAAwD;AACpDJ,cAAAA,CAAC,CAACM,WAAF;AACH;AACJ,WAJW,CAAZ;AAMArB,UAAAA,QAAQ,CAACqB,WAAT;AACH;;AAlD0D,O","sourcesContent":["import { CCString, _decorator, SpriteFrame, Component, Button } from 'cc';\r\nimport { FieldController } from '../../field/FieldController';\r\nimport { TileController } from '../TileController';\r\nimport { TileInterBehaviour } from '../TileInterBehaviour';\r\nimport { TileState } from '../TileState';\r\nimport { BombTileController } from './BombTileController';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * Implements behaviour for bomb tiles\r\n */\r\n\r\n@ccclass('BombTileInterBehaviour')\r\nexport class BombTileInterBehaviour extends TileInterBehaviour {\r\n    tileClicked(field: FieldController, tile: TileController) {\r\n\r\n        if (!(tile instanceof BombTileController)) {\r\n            return;\r\n        }\r\n\r\n        const bombTile = tile as BombTileController;\r\n\r\n        let startRow = tile.row - bombTile.fireDistance;\r\n        startRow = startRow < 0 ? 0 : startRow;\r\n\r\n        let endRow = tile.row + bombTile.fireDistance;\r\n        endRow = endRow >= field.fieldModel.rows ?\r\n            field.fieldModel.rows - 1 : endRow;\r\n\r\n        let startCol = tile.col - bombTile.fireDistance;\r\n        startCol = startCol < 0 ? 0 : startCol;\r\n\r\n        let endCol = tile.col + bombTile.fireDistance;\r\n        endCol = endCol >= field.fieldModel.cols ?\r\n            field.fieldModel.cols - 1 : endCol;\r\n\r\n        const iterateTiles = (callback: (t: TileController) => void) => {\r\n\r\n            for (let i = startRow; i <= endRow; i++) {\r\n                for (let j = startCol; j <= endCol; j++) {\r\n                    const t = field.logicField[i][j];\r\n                    callback(t);\r\n                }\r\n            }\r\n        };\r\n\r\n        iterateTiles((t: TileController) => {\r\n\r\n            if (!t.isDestroied &&\r\n                (t.tileModel.tileName != \"star\") &&\r\n                (t.tileModel.tileName == \"rocket\" ||\r\n                    t.tileModel.tileName == \"bomb\")) {\r\n                t.activate();\r\n            }\r\n        });\r\n\r\n        iterateTiles((t: TileController) => {\r\n            if (!t.isDestroied && (t.tileModel.tileName != \"star\")) {\r\n                t.destroyTile()\r\n            }\r\n        });\r\n\r\n        bombTile.destroyTile();\r\n    }\r\n}\r\n\r\n"]}